<!doctype html>
<html>
<head>
  <title>Walking Controller</title>

  <meta name=viewport content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

  <style>
    .cont {
      text-align: center;
    }

    .cont * {
      display: inline-block;
    }

    .main {
      margin-top: 4em;
    }

    .invisible {
      display: none;
    }

    .btn{
      font-size: 1.3em;
      width: 500px;
      text-align: left;
    }

    .forms-container > form {
      display: block;
    }

    form {
      margin-top: 1em;
      margin-bottom: 0;
      font-size: 1.5em;
    }

    .form-reply {
      width: 750px;
      height: 500px;
      text-align: start;
      vertical-align: top;
      border: 2px solid red;
      word-wrap: anywhere;
    }

    #description {
      padding: 3em;
    }

    #description * {
      text-align: left;
    }

    #description p {
      font-size: 1.3em;
      margin-top: 3em;
    }

    #description b {
      font-weight: bold;
      color: cornflowerblue;
    }

    #description h1 b {
      font-family: 'Lobster', serif;
    }

  </style>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/yarp.js"></script>

</head>


<!-- ############  BODY ################# -->
<body>

<div class="main cont" id="commands">

  <!-- DOM elements for sending wholeBodyDynamics RPC commands -->
  <div class="forms-container" id="wholebodydynamics">

    <form action = "" id='form-send-resetOffset' class="form-inline" style="margin-bottom: 1em">
      <button id="btn-send-resetOffset" type="button" class="btn">
        [resetOffset] Reset FT sensors Offsets
      </button>
      <input type="text" class="form-speak" id="input-send-resetOffset" placeholder="all" value="all">
    </form>

    <form action = "" id='form-send-calib' class="form-inline" style="margin-bottom: 1em">
      <button id="btn-send-calib" type="button" class="btn">
        [calib] Calibrate FT sensors
      </button>
      <input type="text" class="form-speak" id="input-send-calib" placeholder="all 300" value="all 300">
    </form>

    <form action = "" id='form-send-help' class="form-inline" style="margin-bottom: 1em">
      <button id="btn-send-help" type="button" class="btn">
        [help] Help
      </button>
      <input type="text" class="form-speak" id="input-send-help">
    </form>

    <form action = "" id='form-cmd-reply' class="form-inline" style="margin-bottom: 1em">
      <textarea id="replyToWholebodydynamicsCmd" name="text" rows="14" cols="66" wrap="soft" maxlength="100" style="overflow:hidden; resize:none;"></textarea>
    </form>

  </div>
  <!--  -->
</div>

<!-- Initialization of socket.io and yarp.js -->
<script>

  var socket = io();
  yarp.init(socket);
</script>


<!-- yarp.js "main" -->
<script>

  // as soon as the yarp.js module is ready...
  yarp.onInit(function() {

    // Open /wholeBodyDynamics/rpc:o RPC client port
    let wholeBodyDynamicsRPCport = yarp.PortHandler.openPort('/wholeBodyDynamics/rpc:o','rpc');

    // whenever we get a reply from the RPC server, notify the user by displaying "OK!" or "ERROR!"
    // next to the command depending on the received reply.
    wholeBodyDynamicsRPCport.onReplyFromWrite(function (rply) {
      theReplyToWholebodydynamicsCmd = document.getElementById('replyToWholebodydynamicsCmd');
      theReplyToWholebodydynamicsCmd.value = rply.contentStr.toString();
    });

    // Connect the RPC client to the RPC server port
    yarp.Network.connect('/wholeBodyDynamics/rpc:o','/wholeBodyDynamics/rpc');

    // get the handlers to the DOM elements in charge of sending the RPC commands
    let form = {
      resetOffset: document.getElementById('form-send-resetOffset'),
      calib: document.getElementById('form-send-calib'),
      help: document.getElementById('form-send-help')
    }

    // get the handlers to the DOM elements containing the RPC commands parameters
    let input = {
      resetOffset: document.getElementById('input-send-resetOffset').value,
      calib: document.getElementById('input-send-calib').value,
      help: document.getElementById('input-send-help').value
    }

    let btn = {
      resetOffset: document.getElementById('btn-send-resetOffset'),
      calib: document.getElementById('btn-send-calib'),
      help: document.getElementById('btn-send-help')
    }

    // whenever an RPC command is sent (either by pressing the form button
    // or by pressing enter in the text box), send the input parameters.
    Object.keys(form).forEach(function (cmd) {
      function sendCommand() {
        wholeBodyDynamicsRPCport.write(cmd+' '+input[cmd]);
      }
      btn[cmd].onclick = sendCommand;
      form[cmd].addEventListener("submit", function (event) {
        event.preventDefault();
        sendCommand();
      });
    });
  });

</script>

</body>


</html>
